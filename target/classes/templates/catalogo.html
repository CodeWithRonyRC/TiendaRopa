<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{layout/base::head}"></head>
<body class="d-flex flex-column min-vh-100 bg-light">

	<nav th:replace="~{layout/base::navbar}"></nav>

	<main class="container py-4">
		<div class="row">

			<aside class="col-lg-3 mb-4">
				<div class="card shadow-sm border-0 position-sticky"
					style="top: 2rem;">
					<div class="card-header bg-white fw-bold text-uppercase py-3">
						<i class="bi bi-funnel-fill text-warning me-2"></i> Filtros
					</div>
					<div class="card-body p-4">
						<form th:action="@{/catalogo}" method="get">

							<h6 class="fw-bold">Categorías</h6>
							<div class="list-group list-group-flush mb-4">
								<a href="/catalogo"
									class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
									th:classappend="${param.categoria == null} ? 'active fw-bold bg-warning text-dark border-warning'">
									Todas </a> <a th:each="cat : ${categorias}"
									th:href="@{/catalogo(categoria=${cat.id})}"
									class="list-group-item list-group-item-action d-flex justify-content-between align-items-center text-muted"
									th:classappend="${param.categoria != null and #strings.equals(param.categoria, cat.id)} ? 'active fw-bold bg-warning text-dark border-warning'">
									<span th:text="${cat.nombre}"></span> <i
									class="bi bi-chevron-right small"></i>
								</a>
							</div>

							<h6 class="fw-bold">Precio Máximo</h6>
							<div class="mb-4">
								<div class="input-group">
									<span class="input-group-text bg-white text-muted">S/</span> <input
										type="number" name="precioMax" class="form-control"
										placeholder="Ej. 150" th:value="${param.precioMax}" min="0"
										step="1">
									<button class="btn btn-warning" type="submit">
										<i class="bi bi-search"></i>
									</button>
								</div>
							</div>

							<h6 class="fw-bold">Disponibilidad</h6>
							<div class="form-check mb-4">
								<input class="form-check-input" type="checkbox" name="enStock"
									id="checkStock" value="true" th:checked="${param.enStock}"
									onchange="this.form.submit()"> <label
									class="form-check-label" for="checkStock"> Solo
									productos en stock </label>
							</div>

							<div class="d-grid">
								<a href="/catalogo" class="btn btn-outline-secondary btn-sm">Limpiar
									filtros</a>
							</div>
						</form>
					</div>
				</div>
			</aside>

			<section class="col-lg-9">

				<div
					class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
					<h5 class="fw-bold text-dark m-0">Productos Disponibles</h5>
					<span class="badge bg-light text-dark border p-2"
						th:text="${#lists.size(productos) + ' resultados'}"></span>
				</div>

				<div th:if="${#lists.isEmpty(productos)}"
					class="alert alert-warning text-center py-5 shadow-sm border-0">
					<i class="bi bi-emoji-frown fs-1 d-block mb-3"></i>
					<h4>No encontramos productos</h4>
					<p class="text-muted">Intenta ajustar tus filtros de búsqueda.</p>
					<a href="/catalogo" class="btn btn-warning mt-2 fw-bold text-dark">Ver
						todos los productos</a>
				</div>

				<div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">

					<div class="col" th:each="producto : ${productos}">
						<div
							class="card h-100 shadow-sm border-0 product-card overflow-hidden">

							<div class="position-absolute top-0 start-0 p-2 z-index-1">
								<span th:if="${producto.stock == 0}"
									class="badge bg-danger text-uppercase shadow-sm">Agotado</span>
							</div>

							<div
								class="ratio ratio-4x3 bg-white text-center position-relative card-img-wrapper">
								<img
									th:src="${(producto.imagenProductos != null and !producto.imagenProductos.isEmpty())
                                          ? producto.imagenProductos[0].urlImagen
                                          : '/images/no-image.png'}"
									class="card-img-top object-fit-contain p-3 product-image"
									alt="Imagen del producto">
							</div>

							<div class="card-body d-flex flex-column border-top">
								<small class="text-muted text-uppercase mb-1 fw-semibold"
									th:text="${producto.categoria.nombre}"></small>

								<h5 class="card-title fw-bold text-dark text-truncate mb-3"
									th:text="${producto.nombreProducto}"></h5>

								<div class="mb-3">
									<div class="d-flex align-items-center">
										<span class="fs-4 fw-bold text-danger me-2">S/ <span
											th:text="${#numbers.formatDecimal(producto.precio, 1, 2)}"></span></span>
										<small class="text-decoration-line-through text-muted">S/
											<span
											th:text="${#numbers.formatDecimal(producto.precio * 1.2, 1, 2)}"></span>
										</small>
									</div>
								</div>

								<div class="mt-auto d-grid">
									<a th:href="@{/producto/{id}(id=${producto.id})}"
										class="btn btn-warning fw-bold text-dark rounded-pill stretched-link btn-hover-effect">
										Ver producto </a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</main>

	<footer th:replace="~{layout/base::footer}"></footer>

	<style>
/* Hace que la tarjeta flote al pasar el mouse */
.product-card {
	transition: all 0.3s ease;
}

.product-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 1rem 3rem rgba(0, 0, 0, .175) !important;
}

/* Efecto zoom suave en la imagen al pasar el mouse */
.card-img-wrapper {
	overflow: hidden;
}

.product-image {
	transition: transform 0.5s ease;
}

.product-card:hover .product-image {
	transform: scale(1.08);
}

/* Ajusta cómo se ve la imagen dentro del cuadro */
.object-fit-contain {
	object-fit: contain;
	width: 100%;
	height: 100%;
}

/* Estilo para categoría activa en el sidebar */
.list-group-item.active {
	z-index: 2;
	color: #212529;
	background-color: #ffc107;
	border-color: #ffc107;
}
</style>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>