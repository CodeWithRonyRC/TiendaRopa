<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{layout/base::head}"></head>
<body class="d-flex flex-column min-vh-100 bg-light">

	<nav th:replace="~{layout/base::navbar}"></nav>

	<main class="container py-4">
		<div class="row">

			<aside class="col-md-3 mb-4">
				<div class="card shadow-sm border-0">
					<div class="card-header bg-white fw-bold text-uppercase">
						<i class="bi bi-funnel"></i> Filtros
					</div>
					<div class="card-body">
						<form th:action="@{/catalogo}" method="get">

							<h6 class="fw-bold mt-2">Categorías</h6>
							<div class="list-group list-group-flush mb-3">
								<a href="/catalogo"
									class="list-group-item list-group-item-action small"
									th:classappend="${param.categoria == null} ? 'active fw-bold'">
									Todas </a> <a th:each="cat : ${categorias}"
									th:href="@{/catalogo(categoria=${cat.id})}"
									class="list-group-item list-group-item-action small d-flex justify-content-between align-items-center"
									th:classappend="${param.categoria != null and #strings.equals(param.categoria, cat.id)} ? 'active fw-bold'">
									<span th:text="${cat.nombre}"></span> <i
									class="bi bi-chevron-right text-muted"
									style="font-size: 0.8em;"></i>
								</a>
							</div>

							<h6 class="fw-bold">Precio Máximo</h6>
							<div class="input-group input-group-sm mb-3">
								<span class="input-group-text">S/</span> <input type="number"
									name="precioMax" class="form-control" placeholder="Ej. 100"
									th:value="${param.precioMax}">
								<button class="btn btn-warning" type="submit">
									<i class="bi bi-search"></i>
								</button>
							</div>

							<div class="form-check">
								<input class="form-check-input" type="checkbox" name="enStock"
									id="checkStock" value="true" th:checked="${param.enStock}">
								<label class="form-check-label small" for="checkStock">
									Solo en Stock </label>
							</div>

							<div class="d-grid mt-2">
								<button type="submit" class="btn btn-sm btn-outline-dark">Aplicar
									filtros</button>
							</div>
						</form>
					</div>
				</div>
			</aside>

			<section class="col-md-9">

				<div class="d-flex justify-content-between align-items-center mb-3">
					<h4 class="fw-bold text-dark m-0">Productos Disponibles</h4>
					<span class="badge bg-secondary"
						th:text="${#lists.size(productos) + ' resultados'}"></span>
				</div>

				<div th:if="${#lists.isEmpty(productos)}"
					class="alert alert-warning text-center">
					No se encontraron productos con estos filtros. <a href="/catalogo"
						class="alert-link">Ver todos</a>.
				</div>

				<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">

					<div class="col" th:each="producto : ${productos}">
						<div class="card h-100 shadow-sm border-0 product-card">

							<span th:if="${producto.stock == 0}"
								class="position-absolute top-0 start-0 badge bg-danger m-2">AGOTADO</span>
							<span th:if="${producto.stock > 0}"
								class="position-absolute top-0 start-0 badge bg-success m-2">NUEVO</span>

							<div
								class="ratio ratio-1x1 bg-white rounded-top overflow-hidden position-relative group-hover-image">
								<img
									th:src="${(producto.imagenProductos != null and !producto.imagenProductos.isEmpty()) 
                                          ? producto.imagenProductos[0].urlImagen 
                                          : '/images/no-image.png'}"
									class="card-img-top object-fit-contain p-3 transition-transform"
									alt="Imagen producto">
							</div>

							<div class="card-body d-flex flex-column">
								<small class="text-muted text-uppercase"
									th:text="${producto.categoria.nombre}"></small>
								<h5 class="card-title fw-bold text-truncate"
									th:text="${producto.nombreProducto}"></h5>

								<div class="mb-3">
									<span class="fs-5 fw-bold text-danger">S/ <span
										th:text="${producto.precio}"></span></span> <small
										class="text-decoration-line-through text-muted ms-2"
										th:text="'S/ ' + ${producto.precio * 1.2}"></small>
								</div>

								<div class="mt-auto d-grid">
									<a th:href="@{/producto/{id}(id=${producto.id})}"
										class="btn btn-warning fw-bold text-dark rounded-pill">
										Ver producto </a>
								</div>
							</div>
						</div>
					</div>

				</div>
			</section>
		</div>
	</main>

	<footer th:replace="~{layout/base::footer}"></footer>

	<style>
.product-card {
	transition: transform 0.2s, box-shadow 0.2s;
}

.product-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
}

.object-fit-contain {
	object-fit: contain;
	/* Asegura que la imagen completa se vea sin recortarse */
}
</style>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>